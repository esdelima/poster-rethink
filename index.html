<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoAR Futuristik</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #050510; color: white; }
    .glass {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(0,255,255,0.3);
      box-shadow: 0 0 30px rgba(0,255,255,0.4), inset 0 0 15px rgba(0,255,255,0.2);
      backdrop-filter: blur(14px) saturate(180%);
      -webkit-backdrop-filter: blur(14px) saturate(180%);
    }
    #box.locked {
      background: rgba(0,255,255,0.1);
      border: 2px solid rgba(0,255,255,0.7);
      box-shadow: 0 0 40px rgba(0,255,255,0.8);
    }
    .callout-arrow {
      position: absolute; width: 0; height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-top: 14px solid rgba(0,255,255,0.5);
      filter: drop-shadow(0 0 10px rgba(0,255,255,0.7));
      transform: translate(-50%, 0);
    }
    video { transform: scaleX(-1); }
    img.futuristic {
      border: 2px solid rgba(0,255,255,0.6);
      border-radius: 1rem;
      box-shadow: 0 0 25px rgba(0,255,255,0.7);
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="max-w-6xl mx-auto p-4">
    <header class="flex items-center justify-between gap-3 mb-3">
      <h1 class="text-xl font-semibold text-cyan-400">GeoAR Futuristik</h1>
      <button id="btnStart" class="px-4 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-medium">ðŸŽ¥ Nyalakan Kamera</button>
    </header>

    <div id="stage" class="relative rounded-2xl overflow-hidden bg-black aspect-[16/10] select-none">
      <video id="video" playsinline autoplay muted class="w-full h-full object-cover"></video>

      <!-- Overlay kotak 4:5 -->
      <div id="box" class="absolute border-2 border-cyan-400/80 rounded-lg drag-move" style="left:120px; top:80px; width:240px; height:300px;"></div>

      <!-- Callout setelah konfirmasi -->
      <div id="callout" class="hidden absolute glass rounded-xl p-4 max-w-sm">
        <div class="drag-move flex items-start gap-3">
          <div class="grow min-w-0">
            <div class="text-sm font-semibold text-cyan-300">Konten Futuristik</div>
            <div id="calloutBody" class="mt-2 flex flex-col gap-2"></div>
          </div>
          <button id="btnClose" class="ml-2 text-white/80 hover:text-white">âœ–</button>
        </div>
        <div id="arrow" class="callout-arrow"></div>
      </div>

      <div id="hint" class="absolute bottom-3 left-1/2 -translate-x-1/2 text-xs px-3 py-1 rounded-full bg-cyan-500/20 border border-cyan-400/40">Geser dan ubah ukuran kotak 4:5 â†’ Klik di kotak untuk konfirmasi</div>
    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const stage = document.getElementById('stage');
    const box = document.getElementById('box');
    const callout = document.getElementById('callout');
    const calloutBody = document.getElementById('calloutBody');
    const arrow = document.getElementById('arrow');
    const btnStart = document.getElementById('btnStart');
    const btnClose = document.getElementById('btnClose');
    const hint = document.getElementById('hint');

    let stream = null;
    let locked = false;

    const images = [
      "https://iili.io/FmPOlgR.png",
      "https://iili.io/FmPOc0v.png",
      "https://iili.io/FmPO7sa.png",
      "https://iili.io/FmPO5Wg.png",
      "https://iili.io/FmPO1Jp.png"
    ];

    btnStart.addEventListener('click', async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false });
        video.srcObject = stream; await video.play();
      } catch(e){
        alert('Gagal mengakses kamera. Pastikan HTTPS & izin kamera aktif.');
        console.error(e);
      }
    });

    // Klik untuk konfirmasi area
    box.addEventListener('click', () => {
      if(locked) return;
      locked = true;
      box.classList.add('locked');
      hint.classList.add('hidden');
      showCallout();
    });

    btnClose.addEventListener('click', () => {
      callout.classList.add('hidden');
      box.classList.remove('locked');
      locked = false; hint.classList.remove('hidden');
    });

    function showCallout(){
      calloutBody.innerHTML = '';
      images.forEach(url => {
        const img = new Image(); img.src = url; img.className = 'futuristic w-full object-contain';
        calloutBody.appendChild(img);
      });

      const br = box.getBoundingClientRect();
      const st = stage.getBoundingClientRect();
      const targetX = br.left - st.left + br.width/2;
      const targetY = br.top - st.top;

      callout.style.left = Math.max(8, Math.min(st.width-8-300, targetX - 150)) + 'px';
      callout.style.top  = Math.max(8, targetY - 120) + 'px';
      callout.classList.remove('hidden');
      updateArrow();
    }

    function updateArrow(){
      const br = box.getBoundingClientRect(); const st = stage.getBoundingClientRect();
      const tipX = br.left - st.left + br.width/2;
      const cr = callout.getBoundingClientRect();
      arrow.style.left = Math.max(12, Math.min(callout.offsetWidth-12, tipX - (cr.left - st.left))) + 'px';
      arrow.style.top  = (callout.offsetHeight - 2) + 'px';
    }

    // Cleanup camera
    window.addEventListener('beforeunload', () => { if(stream){ stream.getTracks().forEach(t => t.stop()); } });
  </script>
</body>
</html>
